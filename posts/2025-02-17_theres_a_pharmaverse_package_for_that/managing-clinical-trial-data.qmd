---
title: "Working with Clinical Trial Data? There’s a Pharmaverse Package for That"
author:
  - name: Gift Kenneth
  - name: Sunil Gupta
  - name: APPSILON
description: "Looking for R packages to manage clinical trial data? Pharmaverse has tools for every stage from data collection to submission."
date: "2025-02-17"
# please do not use any non-default categories.
# You can find the default categories in the repository README.md
categories: [Technical, Community]
# feel free to change the image
image: "pharmaverse-post.png"
---

<!--------------- typical setup ----------------->

```{r setup, include=FALSE}
long_slug <- "2025-02-17_managing_clinical_trial_data..."
# renv::use(lockfile = "renv.lock")
```

<!--------------- post begins here ----------------->

Working with clinical trial data is no small task. It needs to be precise, compliant, and efficient. Traditionally, this meant using proprietary tools and working within siloed systems, which often made the process more complicated and expensive than necessary. But we think there’s a better way.

The [**pharmaverse**](https://pharmaverse.org/) is an open-source ecosystem of R packages built specifically for clinical trials. These tools integrate seamlessly with the [Tidyverse](https://www.tidyverse.org/), making data management more flexible, efficient, and transparent.

Whether you’re collecting, validating, analyzing, or preparing data for regulatory submission, there’s a pharmaverse package designed to support your workflow and help you work smarter.

This post covers:

-   Key stages of clinical trials and the R packages that support them

-   Creating ADSL datasets and essential programming steps

-   Key players in pharmaverse and whether you need all packages

-   How pharmaverse compares to Tidyverse and how to learn it

By the end, you'll have a clear understanding of how pharmaverse supports clinical trial operations and how to apply these tools in your work.

## Key Stages of Clinical Reporting

Managing clinical trial data involves multiple stages, each with its own challenges. **Pharmaverse** provides a range of R packages that support different parts of the process, sometimes even offering multiple options for the same task. This flexibility allows organizations to choose the best tools for their specific needs rather than sticking to a one-size-fits-all approach.

A **metadata-driven approach** helps ensure that clinical trial data is consistently structured and aligned with regulatory standards. The typical process follows this sequence:

**Metadata** ➝ **OAK** ➝ **Admiral** ➝ **Define.xml** ➝ **TLGs** ➝ **Submissions**

Some examples of **pharmaverse** packages that support clinical reporting include:

-   [**diffdf**](https://cran.r-project.org/web/packages/diffdf/vignettes/diffdf-basic.html) – Tracking differences in datasets, useful for QC'ing.
-   [**metatools**](https://pharmaverse.github.io/metatools/) – Metadata management and transformation.
-   [**sdtm.oak**](https://pharmaverse.github.io/sdtm.oak/) – The primary **pharmaverse** package for SDTM dataset creation.
-   [**sdtmchecks**](https://pharmaverse.github.io/sdtmchecks/) – Validates SDTM datasets for compliance with CDISC standards.
-   [**admiral**](https://github.com/pharmaverse/admiral) – Standardized data derivations.
-   [**metacore**](https://cran.r-project.org/web/packages/metacore/index.html) – Metadata-driven structures.
-   [**rtables**](https://github.com/insightsengineering/rtables) – Structured table outputs.
-   The **pharmaverse** provides multiple table-making packages, such as [chevron](https://insightsengineering.github.io/chevron/latest-tag/), [Tplyr](https://github.com/atorus-research/Tplyr), [pharmaRTF](https://atorus-research.github.io/pharmaRTF/), [gtsummary](https://www.danieldsjoberg.com/gtsummary/), [cards](https://insightsengineering.github.io/cards/latest-tag/), [tfrmt](https://gsk-biostatistics.github.io/tfrmt/), and [tidytlg](https://pharmaverse.github.io/tidytlg/main/). More tools are listed on the [TLGs page](https://pharmaverse.org/e2eclinical/tlg/).
-   [**xportr**](https://github.com/atorus-research/xportr) – CDISC-compliant dataset export.
-   [**pkglite**](https://merck.github.io/pkglite/) – Package management and tracking.
-   [**metacore**](https://github.com/atorus-research/metacore), [**metatools**](https://pharmaverse.github.io/metatools/) – For standardized metadata structures and validation.
-   [**sdtmchecks**](https://github.com/pharmaverse/sdtmchecks), [**datacutr**](https://cran.r-project.org/web/packages/datacutr/index.html) – Ensuring data integrity and regulatory compliance.

Pharmaverse packages are built on top of **[tidyverse](https://www.tidyverse.org/)** tools and integrate seamlessly with packages like **[dplyr](https://dplyr.tidyverse.org/)** for data manipulation and **[ggplot2](https://ggplot2.tidyverse.org/)** for visualization.

> **Note:** This post highlights some key **pharmaverse** packages relevant to clinical reporting. For a full and up-to-date list, visit the [Pharmaverse website](https://pharmaverse.org/). If there's a package we missed that should be included, let us know, and we’d be happy to update this post.

By using these tools, organizations can optimize their data pipeline, ensuring clinical data is well-structured and ready for regulatory submission with ease.

## **Example: Creating ADSL**

Building an ADSL dataset involves several key steps, from reading in data to deriving treatment variables and population flags. While these steps apply regardless of the tools used, **pharmaverse packages like {admiral} simplify the process** with functions designed for CDISC-compliant datasets.

This example is based on the [ADSL template](https://cran.r-project.org/web/packages/admiral/vignettes/adsl.html), which provides a structured approach to creating an ADSL dataset.

#### **Step 1: Read in Data**

To begin, clinical trial datasets such as **DM, EX, DS, AE, and LB** are loaded. The [{pharmaversesdtm}](https://github.com/pharmaverse/pharmaversesdtm) package provides sample CDISC SDTM datasets:

``` r
library(admiral)
library(dplyr, warn.conflicts = FALSE)
library(pharmaversesdtm)
library(stringr)
library(magrittr)

# Load sample data
data("dm", package = "pharmaversesdtm")
data("ex", package = "pharmaversesdtm")
data("ds", package = "pharmaversesdtm")
```

ADSL is typically **built from the DM dataset**, removing unnecessary columns and adding treatment variables in one step:

``` r
adsl <- dm %>%
  select(-DOMAIN) %>%
  mutate(
    TRT01P = ARM,
    TRT01A = ACTARM
  )
```

#### **Step 2: Derive Treatment Variables**

Using {admiral}, we extract and standardize treatment dates from the EX dataset:

``` r
ex_ext <- ex %>%
  filter(!is.na(USUBJID)) %>%
  derive_vars_dt(
    dtc = EXSTDTC,
    new_vars_prefix = "EXST"
  ) %>%
  derive_vars_dt(
    dtc = EXENDTC,
    new_vars_prefix = "EXEN"
  )
```

Then merge these dates into ADSL:

``` r
adsl <- adsl %>%
  derive_vars_merged(
    dataset_add = ex_ext,
    filter_add = EXDOSE > 0 | (EXDOSE == 0 & str_detect(EXTRT, "PLACEBO")),
    new_vars = exprs(TRTSDT = EXSTDT, TRTEDT = EXENDT),
    by_vars = exprs(STUDYID, USUBJID)
  )
```

#### **Step 3: Derive End of Study (EOS) Status**

The disposition dataset (DS) is used to determine when a patient exited the study:

``` r
ds_ext <- ds %>%
  filter(!is.na(DSSTDTC)) %>%
  derive_vars_dt(
    dtc = DSSTDTC,
    new_vars_prefix = "DSST"
  )

adsl <- adsl %>%
  derive_vars_merged(
    dataset_add = ds_ext,
    by_vars = exprs(STUDYID, USUBJID),
    new_vars = exprs(EOSDT = DSSTDT),
    filter_add = DSCAT == "DISPOSITION EVENT" & DSDECOD != "SCREEN FAILURE"
  )
```

#### **Step 4: Assign Population Flags**

For safety population (`SAFFL`), we check if the patient received a treatment dose:

``` r
adsl <- adsl %>%
  derive_var_merged_exist_flag(
    dataset_add = ex,
    by_vars = exprs(STUDYID, USUBJID),
    new_var = SAFFL,
    condition = EXDOSE > 0 | str_detect(EXTRT, "PLACEBO")
  )
```

#### **Step 5: Generate and Save Results**

Finally, we print the results and save them to a CSV file:

``` r
tryCatch({
  print("ADSL creation complete. Showing first few rows:")
  print(head(adsl))
  
  print("\nSummary of ADSL variables:")
  print(summary(adsl))
  
  # Save to a CSV file
  write.csv(adsl, "adsl_output.csv", row.names = FALSE)
  print("\nADSL has been saved to 'adsl_output.csv'")
}, error = function(e) {
  print(paste("An error occurred:", e$message))
})
```
**Results**

``` r
[1] "ADSL creation complete. Showing first few rows:"
       STUDYID     USUBJID SUBJID    RFSTDTC    RFENDTC   RFXSTDTC   RFXENDTC RFICDTC         RFPENDTC DTHDTC DTHFL SITEID AGE
1 CDISCPILOT01 01-701-1015   1015 2014-01-02 2014-07-02 2014-01-02 2014-07-02    <NA> 2014-07-02T11:45   <NA>  <NA>    701  63
2 CDISCPILOT01 01-701-1023   1023 2012-08-05 2012-09-02 2012-08-05 2012-09-01    <NA>       2013-02-18   <NA>  <NA>    701  64
3 CDISCPILOT01 01-701-1028   1028 2013-07-19 2014-01-14 2013-07-19 2014-01-14    <NA> 2014-01-14T11:10   <NA>  <NA>    701  71
4 CDISCPILOT01 01-701-1033   1033 2014-03-18 2014-04-14 2014-03-18 2014-03-31    <NA>       2014-09-15   <NA>  <NA>    701  74
5 CDISCPILOT01 01-701-1034   1034 2014-07-01 2014-12-30 2014-07-01 2014-12-30    <NA> 2014-12-30T09:50   <NA>  <NA>    701  77
6 CDISCPILOT01 01-701-1047   1047 2013-02-12 2013-03-29 2013-02-12 2013-03-09    <NA>       2013-07-28   <NA>  <NA>    701  85
   AGEU SEX  RACE                 ETHNIC  ARMCD                  ARM ACTARMCD               ACTARM COUNTRY      DMDTC DMDY
1 YEARS   F WHITE     HISPANIC OR LATINO    Pbo              Placebo      Pbo              Placebo     USA 2013-12-26   -7
2 YEARS   M WHITE     HISPANIC OR LATINO    Pbo              Placebo      Pbo              Placebo     USA 2012-07-22  -14
3 YEARS   M WHITE NOT HISPANIC OR LATINO Xan_Hi Xanomeline High Dose   Xan_Hi Xanomeline High Dose     USA 2013-07-11   -8
4 YEARS   M WHITE NOT HISPANIC OR LATINO Xan_Lo  Xanomeline Low Dose   Xan_Lo  Xanomeline Low Dose     USA 2014-03-10   -8
5 YEARS   F WHITE NOT HISPANIC OR LATINO Xan_Hi Xanomeline High Dose   Xan_Hi Xanomeline High Dose     USA 2014-06-24   -7
6 YEARS   F WHITE NOT HISPANIC OR LATINO    Pbo              Placebo      Pbo              Placebo     USA 2013-01-22  -21
                TRT01P               TRT01A      EOSDT SAFFL
1              Placebo              Placebo 2014-07-02     Y
2              Placebo              Placebo 2012-09-02     Y
3 Xanomeline High Dose Xanomeline High Dose 2014-01-14     Y
4  Xanomeline Low Dose  Xanomeline Low Dose 2014-04-14     Y
5 Xanomeline High Dose Xanomeline High Dose 2014-12-30     Y
6              Placebo              Placebo 2013-03-29     Y
```

``` r
[1] "\nSummary of ADSL variables:"
   STUDYID            USUBJID             SUBJID            RFSTDTC            RFENDTC            RFXSTDTC        
 Length:306         Length:306         Length:306         Length:306         Length:306         Length:306        
 Class :character   Class :character   Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                                                                                                                                                                
   RFXENDTC           RFICDTC            RFPENDTC            DTHDTC             DTHFL              SITEID         
 Length:306         Length:306         Length:306         Length:306         Length:306         Length:306        
 Class :character   Class :character   Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                                                                                                                                                              
      AGE            AGEU               SEX                RACE              ETHNIC             ARMCD          
 Min.   :50.00   Length:306         Length:306         Length:306         Length:306         Length:306        
 1st Qu.:70.25   Class :character   Class :character   Class :character   Class :character   Class :character  
 Median :77.00   Mode  :character   Mode  :character   Mode  :character   Mode  :character   Mode  :character  
 Mean   :75.09                                                                                                 
 3rd Qu.:81.00                                                                                                 
 Max.   :89.00                                                                                                 
                                                                                                               
     ARM              ACTARMCD            ACTARM            COUNTRY             DMDTC                DMDY    
 Length:306         Length:306         Length:306         Length:306         Length:306         Min.   :-37  
 Class :character   Class :character   Class :character   Class :character   Class :character   1st Qu.:-14  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character   Mode  :character   Median :-10  
                                                                                                Mean   :-11  
                                                                                                3rd Qu.: -7  
                                                                                                Max.   : -2  
                                                                                                NA's   :52   
    TRT01P             TRT01A              EOSDT               SAFFL          
 Length:306         Length:306         Min.   :2012-09-01   Length:306        
 Class :character   Class :character   1st Qu.:2013-05-16   Class :character  
 Mode  :character   Mode  :character   Median :2013-09-30   Mode  :character  
                                       Mean   :2013-10-15                     
                                       3rd Qu.:2014-03-20                     
                                       Max.   :2015-03-05                     
                                       NA's   :52                             
[1] "\nADSL has been saved to 'adsl_output.csv'"
```

#### **More Details on ADSL Creation**

This is just a **high-level example**; the full process includes deriving death variables, grouping populations, and applying labels. For a deeper dive, check out the [ADSL Implementation Guide](https://cran.r-project.org/web/packages/admiral/vignettes/adsl.html).

![](images/adsl.png)

## **Who Are the Key Players in Pharmaverse, and Do You Need to Use All Packages?**

### **Key Players in pharmaverse**

-   **Pharmaverse Council and Community** – A collaborative group of developers, industry experts, and contributors maintaining and expanding the ecosystem.
-   **Open-Source Contributors** – Individuals and organizations developing and refining **pharmaverse** packages.
-   **Pharmaverse is supported by [PHUSE](https://phuse.global/)** – PHUSE plays an active role in supporting and advancing the **pharmaverse** initiative.
-   **The pharmaverse community collaborates with organizations like the FDA, EMA, R Consortium, and CDISC** to align with industry standards and best practices for clinical data reporting.


### **Do You Need to Use All Pharmaverse Packages?**

-   No, organizations can select only the packages that fit their needs.

-   Many packages are modular and independent, allowing selective integration.

-   Pharmaverse hosts multiple packages with similar aims, giving users the flexibility to choose what works best for them rather than prescribing a single approach.

-   Pharmaverse complements [Tidyverse](https://www.tidyverse.org/), allowing organizations to continue using familiar R workflows.

## **How Pharmaverse Differs from Tidyverse & How to Learn It Effectively**

#### **Differences Between pharmaverse and Tidyverse**

-   Pharmaverse is designed specifically for clinical reporting, while Tidyverse provides general-purpose data science tools.

-   Pharmaverse integrates Tidyverse functions but adds compliance, validation, and reporting features for regulatory submissions.

-   Tidyverse focuses on generic data wrangling and visualization, while pharmaverse extends this to pharma-specific clinical data structuring, reporting, and submission-ready formatting.

## **Getting Started with the Pharmaverse**

Pharmaverse provides an open-source ecosystem for clinical reporting, extending Tidyverse with validation, compliance, and regulatory submission capabilities. By following a structured approach from raw data to ADaMs, organizations can enhance efficiency while maintaining data integrity.

- You can [start with Pharmaverse Examples](https://pharmaverse.github.io/examples/) – A curated set of documentation and tutorials.

- Attend Pharma Industry Webinars and Conferences – Stay updated on new developments through events like [PHUSE events and webinars](https://phuse.global/Events_Calendar), [R/Pharma conferences and events](https://rinpharma.com/), [CDISC events](https://www.cdisc.org/events), [Shiny Gatherings x Pharmaverse webinars](https://www.youtube.com/playlist?list=PLexAKolMzPcpzPAXNU6KlQ_UpIFsuEPCx), etc.

-  Engage with the Open-Source Community – Contribute to package improvements or discussions. [You can join the pharmaverse community to get started.](join the pharmaverse](https://join.slack.com/t/pharmaverse/shared_invite/zt-yv5atkr4-Np2ytJ6W_QKz_4Olo7Jo9A)).

- Explore packages on the [pharmaverse website](https://pharmaverse.org).

- Try implementing an ADSL dataset using [CRAN Admiral ADSL](https://cran.r-project.org/web/packages/admiral/vignettes/adsl.html). 

- Refer to [this grid for guidance on using Tidyverse or pharmaverse](https://r-guru.com/pharma) to complete tasks in the submission process. 



### **Resources**

-   This blog post was based on this presentation by Sunil Gupta: [R and pharmaverse: The New Frontier for Today’s Statistical Programmers](https://phuse.s3.eu-central-1.amazonaws.com/Archive/2024/SDE/US/Mississauga/PRE_Mississauga05.pdf)

-   [R-Guru Resource Hub for Rapid R Learning](https://www.lexjansen.com/phuse-us/2024/pd/PAP_PD05.pdf)

-   [Explore more posts in the pharmaverse blog](https://pharmaverse.github.io/blog/)

-   [Subscribe to the pharmaverse newsletter](https://forms.office.com/pages/responsepage.aspx?id=xeEJLj1cykuXxFc6VpX1UAPF0grflaRJu8z6VC7-hy5UMTE0M0lXR1JON1Q0MkRIRlA1TlZSNDhUSC4u&route=shorturl)

<!--------------- appendices go here ----------------->

```{r, echo=FALSE, message = FALSE}
source("appendix.R")
insert_appendix(
  repo_spec = "pharmaverse/blog",
  name = long_slug,
  # file_name should be the name of your file
  file_name = list.files() %>% stringr::str_subset(".qmd") %>% first()
)
```
