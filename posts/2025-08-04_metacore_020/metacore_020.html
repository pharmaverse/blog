<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.12">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Liam Hobby">
<meta name="dcterms.date" content="2025-08-04">
<meta name="description" content="metacore and metatools 0.2.0 are live. Read package release information and hear from the new maintainer.">

<title>Metacore and Metatools 0.2.0 – pharmaverse blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../media/pharmaverseblog.png" rel="icon" type="image/png">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-cdaacfc258cb6f151192107f105ac881.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-137fb87ad92308327f354b66520e45c1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6ZDR80SCKG"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-6ZDR80SCKG', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  
<style>

      .quarto-title-block .quarto-title-banner {
        background: #eeeeee;
      }
</style>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Metacore and Metatools 0.2.0 – pharmaverse blog">
<meta property="og:description" content="metacore and metatools 0.2.0 are live. Read package release information and hear from the new maintainer.">
<meta property="og:image" content="https://pharmaverse.github.io/blog/posts/2025-08-04_metacore_020/metacore.png">
<meta property="og:site_name" content="pharmaverse blog">
<meta property="og:image:height" content="552">
<meta property="og:image:width" content="590">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">pharmaverse blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/pharmaverse/blog"> <i class="bi bi-github" role="img" aria-label="github">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../session_info.html"> 
<span class="menu-text">Session Info</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Metacore and Metatools 0.2.0</h1>
                  <div>
        <div class="description">
          metacore and metatools 0.2.0 are live. Read package release information and hear from the new maintainer.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Metadata</div>
                <div class="quarto-category">ADaM</div>
                <div class="quarto-category">Community</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Liam Hobby </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 4, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#metacore-and-metatools-have-a-new-package-maintainer" id="toc-metacore-and-metatools-have-a-new-package-maintainer" class="nav-link active" data-scroll-target="#metacore-and-metatools-have-a-new-package-maintainer"><code>{metacore}</code> and <code>{metatools}</code> have a new package maintainer</a></li>
  <li><a href="#whats-new-in-metacore" id="toc-whats-new-in-metacore" class="nav-link" data-scroll-target="#whats-new-in-metacore">What’s new in metacore?</a></li>
  <li><a href="#create_var_from_codelist" id="toc-create_var_from_codelist" class="nav-link" data-scroll-target="#create_var_from_codelist"><code>create_var_from_codelist()</code></a></li>
  <li><a href="#create_cat_var" id="toc-create_cat_var" class="nav-link" data-scroll-target="#create_cat_var">create_cat_var()</a></li>
  <li><a href="#summary-of-other-changes" id="toc-summary-of-other-changes" class="nav-link" data-scroll-target="#summary-of-other-changes">Summary of Other Changes</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">What’s next?</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<!--------------- typical setup ----------------->
<!--------------- post begins here ----------------->
<section id="metacore-and-metatools-have-a-new-package-maintainer" class="level2">
<h2 class="anchored" data-anchor-id="metacore-and-metatools-have-a-new-package-maintainer"><code>{metacore}</code> and <code>{metatools}</code> have a new package maintainer</h2>
<p>Hi, everyone! I’m <a href="https://www.linkedin.com/in/liam-hobby/" title="Liam Hobby">Liam</a> and I’m excited to announce that I have taken over as package maintainer for both <code>{metacore}</code> and <code>{metatools}</code> from Christina Fillmore. I work at GSK as a clinical programmer and I am coming to the end of my second year in the industry. This is my first experience working within the open-source world, but I am a regular user of pharmaverse packages and am keen to get more involved with the community.</p>
<p>Christina remains on-hand as a mentor and I’d like to thank both her and Ben Straub for the continued support before we dive into the details of <code>{metacore}</code>/<code>{metatools}</code> 0.2.0.</p>
</section>
<section id="whats-new-in-metacore" class="level2">
<h2 class="anchored" data-anchor-id="whats-new-in-metacore">What’s new in metacore?</h2>
<p>The goal of version 0.2.0 was to clarify the distinction between an imported Metacore spec, containing information about multiple datasets, and a subsetted spec containing information about just a single dataset (as achieved via metacore::select_dataset()).</p>
<p>We received a number of questions and issues raised where users were attempting to use a Metacore object containing metadata for multiple datasets in functions from <code>{metatools}</code> that were designed to take a single, subsetted specification. When developing datasets, the typical workflow is to be working on a single dataset at a time - so subsetting the Metacore object is the logical thing to do. The issue was that the approach to functions in <code>{metatools}</code> was inconsistent, with some functions permitting multiple specification metadata and others not.</p>
<p>Now, a Metacore object which has multiple datasets or one with a single dataset have been redesigned to be programmatically distinct, with the single dataset implemented as a subclass of Metacore called “DatasetMeta”.</p>
<p>From the users’ perspective there is one key change. <strong>A metadata object about a single dataset will be required for users to work with <code>{metatools}</code> functions</strong>, which have had their API harmonised to accept only subsetted Metacore objects (via <code>metacore::select_dataset()</code>).</p>
<p>The print statements of both combined and subsetted Metacore objects have been refined to better illustrate the differences between them and provide more helpful information to the user.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metacore)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metatools)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">metacore_example</span>(<span class="st">"pilot_ADaM.rda"</span>))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>metacore</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Metacore object contains metadata for 5 datasets ────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ ADSL (Subject-Level Analysis Dataset)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ ADADAS (ADAS-Cog Analysis)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ ADLBC (Analysis Dataset Lab Blood Chemistry)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ ADTTE (AE Time To 1st Derm. Event Analysis)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ ADAE (Adverse Events Analysis Dataset)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ To use the Metacore object with metatools package, first subset a dataset using `metacore::select_dataset()`</code></pre>
</div>
</div>
<p>The <code>metacore::select_dataset()</code> function is now explicit about what is being selected:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>adsl_spec <span class="ot">&lt;-</span> <span class="fu">select_dataset</span>(metacore, <span class="st">"ADSL"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ ADSL dataset successfully selected</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Dataset metadata specification subsetted with suppressed warnings</code></pre>
</div>
</div>
<p>Printing the subsetted object now provides more detailed information:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>adsl_spec</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Dataset specification object for ADSL (Subject-Level Analysis Dataset) ──────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The dataset contains 51 variables</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Dataset key: USUBJID</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The structure of the specification object is:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ codelist: character [16 x 4] code_id, name, type, codes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ derivations: character [50 x 2] derivation_id derivation</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ ds_spec: character [1 x 3] dataset, structure, label</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ ds_vars: character [51 x 7] dataset, variable, key_seq, order, keep, core,
  supp_flag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ supp: character [0 x 4] dataset, variable, idvar, qeval</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ value_spec: character [51 x 8] dataset, variable, code_id, derivation_id,
  type, origin, where, sig_dig</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>→ var_spec: character [51 x 6] variable, type, length, label, format, common</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>To inspect the specification object use `View()` in the console.</code></pre>
</div>
</div>
<p>Functions that take a Metacore object as input will emit a helpful message if a subsetted object is not supplied.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ds_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">DM =</span> <span class="fu">read_xpt</span>(<span class="fu">metatools_example</span>(<span class="st">"dm.xpt"</span>)))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">create_var_from_codelist</span>(<span class="fu">data.frame</span>(), metacore)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `verify_DatasetMeta()`:
! The object supplied to the argument `metacore` is not a subsetted
  Metacore object. Use `metacore::select_dataset()` to subset metadata for the
  required dataset.</code></pre>
</div>
</div>
<section id="related-soft-deprecation-of-dataset_name-in-metatools" class="level4">
<h4 class="anchored" data-anchor-id="related-soft-deprecation-of-dataset_name-in-metatools">Related: soft deprecation of <code>dataset_name</code> in metatools</h4>
<p>Additionally, the argument <code>dataset_name</code> has been <strong>soft-deprecated</strong> across all functions in <code>{metatools}</code>. While the argument is still available and will not break existing code, using it will now issue a warning. This change encourages users to adopt the preferred workflow, creating a subsetted Metacore object, and improves performance by avoiding repeated subsetting operations each time these functions are called.</p>
<p>The full list of affected functions is included below. The <code>dataset_name</code> argument will remain available for <strong>at least one year</strong> from the release date of 0.2.0 before being fully removed.</p>
<p><a href="https://pharmaverse.github.io/metatools/reference/build_from_derived.html" title="Build a dataset from derived"><code>build_from_derived</code></a>, <a href="https://pharmaverse.github.io/metatools/reference/check_variables.html" title="Check Variable Names"><code>check_variables</code></a>, <a href="https://pharmaverse.github.io/metatools/reference/check_unique_keys.html" title="Check Uniqueness of Records by Key"><code>check_unique_keys</code></a>, <a href="https://pharmaverse.github.io/metatools/reference/make_supp_qual.html" title="Make Supplemental Qualifier"><code>make_supp_qual</code></a>, <a href="https://pharmaverse.github.io/metatools/reference/drop_unspec_vars.html" title="Drop Unspecified Variables"><code>drop_unspec_vars</code></a>, <a href="https://pharmaverse.github.io/metatools/reference/add_variables.html" title="Add Missing Variables"><code>add_variables</code></a>, <a href="https://pharmaverse.github.io/metatools/reference/order_cols.html" title="Sort Columns by Order"><code>order_cols</code></a>, <a href="https://pharmaverse.github.io/metatools/reference/sort_by_key.html" title="Sort Rows by Key Sequence"><code>sort_by_key</code></a>.</p>
</section>
</section>
<section id="create_var_from_codelist" class="level2">
<h2 class="anchored" data-anchor-id="create_var_from_codelist"><code>create_var_from_codelist()</code></h2>
<p>metatools::create_var_from_codelist() now optionally allows the user to specify a codelist from which the new column should be generated. This is useful in situations like the one below where the user is trying to derive <code>PARAM</code> from <code>PARAMCD</code> but the codelist for the <code>out_var</code> (<code>PARAM</code>) does not contain the values of <code>PARAMCD</code>.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>ID</th>
<th>Order</th>
<th>Code</th>
<th>Decode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PARAM</td>
<td>1</td>
<td>Alanine Aminotransferase</td>
<td>Alanine Aminotransferase</td>
</tr>
<tr class="even">
<td>PARAM</td>
<td>2</td>
<td>Bilirubin</td>
<td>Bilirubin</td>
</tr>
<tr class="odd">
<td>PARAM</td>
<td>3</td>
<td>Creatine</td>
<td>Creatine</td>
</tr>
</tbody>
</table>
<p>Example of default usage not providing the correct result:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>adlbc_spec <span class="ot">&lt;-</span> <span class="fu">suppressMessages</span>(<span class="fu">select_dataset</span>(metacore, <span class="st">"ADLBC"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">PARAMCD =</span> <span class="fu">c</span>(<span class="st">"ALB"</span>, <span class="st">"ALP"</span>, <span class="st">"ALT"</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">create_var_from_codelist</span>(data, adlbc_spec, <span class="at">input_var =</span> PARAMCD, <span class="at">out_var =</span> PARAM, <span class="at">strict =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  PARAMCD PARAM
  &lt;chr&gt;   &lt;chr&gt;
1 ALB     &lt;NA&gt; 
2 ALP     &lt;NA&gt; 
3 ALT     &lt;NA&gt; </code></pre>
</div>
</div>
<p>By default, metatools::create_var_from_codelist() takes the codelist of the <code>out_var</code> as input. The user can now overwrite this default with a specific codelist (in this case <code>PARAMCD</code> below) to achieve the desired result.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>ID</th>
<th>Order</th>
<th>Code</th>
<th>Decode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>PARAMCD</td>
<td>1</td>
<td>ALT</td>
<td>Alanine Aminotransferase</td>
</tr>
<tr class="even">
<td>PARAMCD</td>
<td>2</td>
<td>BILI</td>
<td>Bilirubin</td>
</tr>
<tr class="odd">
<td>PARAMCD</td>
<td>3</td>
<td>CREAT</td>
<td>Creatine</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">create_var_from_codelist</span>(data, adlbc_spec, <span class="at">input_var =</span> PARAMCD, <span class="at">out_var =</span> PARAM, <span class="at">codelist =</span> <span class="fu">get_control_term</span>(adlbc_spec, PARAMCD), <span class="at">decode_to_code =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  PARAMCD PARAM                         
  &lt;chr&gt;   &lt;chr&gt;                         
1 ALB     Albumin (g/L)                 
2 ALP     Alkaline Phosphatase (U/L)    
3 ALT     Alanine Aminotransferase (U/L)</code></pre>
</div>
</div>
<p>This function also provides a new option <code>strict</code>, which when set to <code>TRUE</code> (default) will issue a warning indicating any values in your input column that do not appear in the codelist.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">PARAMCD =</span> <span class="fu">c</span>(<span class="st">"ALB"</span>, <span class="st">"ALP"</span>, <span class="st">"ALT"</span>, <span class="st">"DUMMY1"</span>, <span class="st">"DUMMY2"</span>))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">create_var_from_codelist</span>(data, adlbc_spec, <span class="at">input_var =</span> PARAMCD, <span class="at">out_var =</span> PARAM, <span class="at">codelist =</span> <span class="fu">get_control_term</span>(adlbc_spec, PARAMCD), <span class="at">decode_to_code =</span> <span class="cn">FALSE</span>, <span class="at">strict =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: In `create_var_from_codelist()`: The following values present in the input
dataset are not present in the codelist: DUMMY1 and DUMMY2</code></pre>
</div>
</div>
</section>
<section id="create_cat_var" class="level2">
<h2 class="anchored" data-anchor-id="create_cat_var">create_cat_var()</h2>
<p>metatools::create_cat_var() has been updated so that users can now specify to create a new variable from either the <code>code</code> or <code>decode</code> column of the controlled terminology. Previously, a codelist set-up like the one below would be evaluated from the <code>code</code> column only, leaving out the “years” text from the new variable.</p>
<table class="caption-top table">
<caption>Example of a codelist for AGEGR2</caption>
<colgroup>
<col style="width: 11%">
<col style="width: 29%">
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>ID</th>
<th>Name</th>
<th>Data Type</th>
<th>Order</th>
<th>Code</th>
<th>Decode</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AGEGR2</td>
<td>Pooled Age Group 2</td>
<td>text</td>
<td>1</td>
<td>&lt;35</td>
<td>&lt;35 years</td>
</tr>
<tr class="even">
<td>AGEGR2</td>
<td>Pooled Age Group 2</td>
<td>text</td>
<td>2</td>
<td>35-49</td>
<td>35-49 years</td>
</tr>
<tr class="odd">
<td>AGEGR2</td>
<td>Pooled Age Group 2</td>
<td>text</td>
<td>3</td>
<td>&gt;= 50</td>
<td>&gt;= 50 years</td>
</tr>
</tbody>
</table>
<p>Now, specifying the option <code>create_from_decode = TRUE</code> will allow you to create the variable based on the text in the <code>decode</code> column. If you are using this option to also create a numeric coded variable (in this case <code>AGEGR2N</code>), ensure your CT is set up so that the <code>decode</code> columns match.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dm <span class="ot">&lt;-</span> <span class="fu">read_xpt</span>(<span class="fu">metatools_example</span>(<span class="st">"dm.xpt"</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">create_cat_var</span>(dm, adsl_spec, AGE, AGEGR2, AGEGR2N, <span class="at">create_from_decode =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(USUBJID, AGE, AGEGR2, AGEGR2N) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  USUBJID       AGE AGEGR2      AGEGR2N
  &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt;
1 01-701-1015    63 18-64 years       1
2 01-701-1023    64 18-64 years       1
3 01-701-1028    71 65-80 years       2
4 01-701-1033    74 65-80 years       2
5 01-701-1034    77 65-80 years       2</code></pre>
</div>
</div>
<p>This function now also provides a default <code>strict = TRUE</code> option, that issues a warning message if there are values in the reference column that do not fit into the categories in the controlled terminology. This can be disabled with <code>strict = FALSE</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dm2 <span class="ot">&lt;-</span> dm <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="at">AGE =</span> <span class="dv">15</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">add_row</span>(<span class="at">AGE =</span> <span class="dv">16</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">create_cat_var</span>(dm2, adsl_spec, AGE, AGEGR2, <span class="at">create_from_decode =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There are 2 observations in AGE that do not fit into the provided categories
for AGEGR2. Please check your controlled terminology.</code></pre>
</div>
</div>
</section>
<section id="summary-of-other-changes" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-other-changes">Summary of Other Changes</h2>
<ul>
<li><p>Fixed a bug where the presence of variables with VLM in the <code>value_spec</code> table would prevent variables of the same name in different datasets being populated in the <code>value_spec</code> table.</p></li>
<li><p>metatools::build_from_derived() adds new options for the <code>keep</code> parameter that allow users to derive either <code>all</code> or only <code>prerequisite</code> columns from source datasets. Thanks to Matt Bearham for this amendment!</p></li>
<li><p>metatools::combine_supp() now adds the label found in <code>QLABEL</code> to the <code>QNAM</code> columns that are derived from supplementary datasets. Thanks to Bill Denney for this amendment!</p></li>
<li><p>metatools::check_variables() now provides a <code>strict</code> option that will issue a warning rather than throw an error when <code>strict = FALSE</code>.</p></li>
<li><p><code>{cli}</code> output is now used across both packages and messaging for various functions has been improved.</p></li>
</ul>
</section>
<section id="whats-next" class="level2">
<h2 class="anchored" data-anchor-id="whats-next">What’s next?</h2>
<p>The next step for both packages will be working through and closing out issues from the backlog, updating the examples and vignettes, and improving the user experience via more informative messaging.</p>
<p>For <code>{metacore}</code>, there has been some interest in a UI to help users write custom specification readers for specs not in the standard P21 format. So this will be explored as well.</p>
<p>I hope to release the next update towards the end of the year, looking at an approximately 6-monthly release schedule going forward. Until then I encourage people to explore some of the new features and provide feedback on the changes through GitHub at the links below:</p>
<ul>
<li><p><a href="https://github.com/atorus-research/metacore" title="GitHub - Metacore">Metacore</a></p></li>
<li><p><a href="https://github.com/pharmaverse/metatools" title="GitHub - Metatools">Metatools</a></p></li>
</ul>
<p>Thanks for reading!</p>
<!--------------- appendices go here ----------------->
</section>
<div class="cell">
<div class="cell-output-display">


</div>
</div>



<div id="quarto-appendix" class="default"><section id="last-updated" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Last updated</h2><div class="quarto-appendix-contents">

<p>2026-02-18 18:49:08.341901</p>
</div></section><section id="details" class="level2 appendix"><h2 class="anchored quarto-appendix-heading">Details</h2><div class="quarto-appendix-contents">

<p><a href="https://github.com/pharmaverse/blog/tree/main/posts/zzz_DO_NOT_EDIT_metacore_0.2.0/metacore_020.qmd">Source</a>, <a href="https://pharmaverse.github.io/blog/session_info.html">Session info</a></p>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{hobby2025,
  author = {Hobby, Liam},
  title = {Metacore and {Metatools} 0.2.0},
  date = {2025-08-04},
  url = {https://pharmaverse.github.io/blog/posts/2025-08-04_metacore_020/metacore_020.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-hobby2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Hobby, Liam. 2025. <span>“Metacore and Metatools 0.2.0.”</span> August
4, 2025. <a href="https://pharmaverse.github.io/blog/posts/2025-08-04_metacore_020/metacore_020.html">https://pharmaverse.github.io/blog/posts/2025-08-04_metacore_020/metacore_020.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/pharmaverse\.github\.io\/blog");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>